C51 COMPILER V9.54   AT24C02                                                               11/09/2022 17:21:14 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE AT24C02
OBJECT MODULE PLACED IN .\Objects\AT24C02.obj
COMPILER INVOKED BY: C:\mywinapp\keil5\C51\BIN\C51.EXE AT24C02.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Lis
                    -tings\AT24C02.lst) TABS(2) OBJECT(.\Objects\AT24C02.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          sbit SCL = P2^1;        //æ—¶é’Ÿçº¿
   4          sbit SDA = P2^0;        //æ•°æ®çº¿
   5          #define AT24C02_ADDR 0xa0 // AT24C02åœ°å€
   6          
   7          void I2C_start(void)
   8          { // SCLé«˜ç”µå¹³æœŸé—´ï¼ŒSDAä»é«˜ç”µå¹³åˆ‡æ¢åˆ°ä½ç”µå¹³
   9   1          SDA = 1;
  10   1          SCL = 1;
  11   1          SDA = 0;
  12   1          SCL = 0;
  13   1      }
  14          void I2C_stop(void)
  15          { // SCLé«˜ç”µå¹³æœŸé—´ï¼ŒSDAä»ä½ç”µå¹³åˆ‡æ¢åˆ°é«˜ç”µå¹³
  16   1          SDA = 0;
  17   1          SCL = 1;
  18   1          SDA = 1;
  19   1          SCL = 0;
  20   1      }
  21          
  22          void I2C_send_byte(char _data)
  23          { // SCLä½ç”µå¹³æœŸé—´ï¼Œä¸»æœºå°†æ•°æ®ä½ä¾æ¬¡æ”¾åˆ°SDAçº¿ä¸Šï¼ˆé«˜ä½åœ¨å‰ï¼‰ï¼Œç„¶åæ‹‰é«˜SCLï¼Œ
  24   1        //ä»æœºå°†åœ¨SCLé«˜ç”µå¹³æœŸé—´è¯»å–æ•°æ®ä½ï¼Œæ‰€ä»¥SCLé«˜ç”µå¹³æœŸé—´SDAä¸å…è®¸æœ‰æ•°æ®å˜åŒ–,
  25   1        //ä¾æ¬¡å¾ªç¯ä¸Šè¿°è¿‡ç¨‹8æ¬¡ï¼Œå³å¯å‘é€ä¸€ä¸ªå­—èŠ‚
  26   1      
  27   1          char i;
  28   1      
  29   1          for (i = 0; i < 8; i++)
  30   1          {
  31   2              SCL = 0;
  32   2              SDA = _data & (0x80 >> i);
  33   2              SCL = 1;
  34   2              SCL = 0;
  35   2          }
  36   1      }
  37          unsigned char I2C_recerve_byte(void) //ä¸ºä»€ä¹ˆunsigned charä¼šå½±å“è¯»æ•°
  38          {
  39   1          //æ¥æ”¶ä¸€ä¸ªå­—èŠ‚ï¼šSCLä½ç”µå¹³æœŸé—´ï¼Œä»æœºå°†æ•°æ®ä½ä¾æ¬¡æ”¾åˆ°SDAçº¿ä¸Šï¼ˆé«˜ä½åœ¨å‰ï¼‰ï
             -¼Œ
  40   1          //ç„¶åæ‹‰é«˜SCLï¼Œä¸»æœºå°†åœ¨SCLé«˜ç”µå¹³æœŸé—´è¯»å–æ•°æ®ä½ï¼Œæ‰€ä»¥SCLé«˜ç”µå¹³æœŸé—´SDAä¸å…è
             -®¸æœ‰æ•°æ®å˜åŒ–ï¼Œ
  41   1          //ä¾æ¬¡å¾ªç¯ä¸Šè¿°è¿‡ç¨‹8æ¬¡ï¼Œå³å¯æ¥æ”¶ä¸€ä¸ªå­—èŠ‚ï¼ˆä¸»æœºåœ¨æ¥æ”¶ä¹‹å‰ï¼Œéœ€è¦é‡Šæ”¾SDAï¼‰
  42   1      
  43   1          char i;
  44   1          unsigned char _data = 0x00;
  45   1          SDA = 1;
  46   1          for (i = 0; i < 8; i++)
  47   1          {
  48   2              SCL = 0;
  49   2              SCL = 1;
  50   2              // SDAå·²ç»æŠŠæ•°æ®æ”¾æ•°æ®çº¿ä¸Šäº†
  51   2              if (SDA)
  52   2              {
C51 COMPILER V9.54   AT24C02                                                               11/09/2022 17:21:14 PAGE 2   

  53   3                  _data |= (0x80 >> i);
  54   3              }
  55   2              SCL = 0;
  56   2          }
  57   1          return _data;
  58   1      }
  59          void I2C_send_response(bit _data)
  60          { //å‘é€åº”ç­”ï¼šåœ¨ï¼Œæ¥æ”¶å®Œä¸€ä¸ªå­—èŠ‚ä¹‹åä¸»æœºåœ¨ä¸‹ä¸€ä¸ªæ—¶é’Ÿå‘é€ä¸€ä½æ•°æ®ï¼Œæ•°æ®0è¡
             -¨ç¤ºåº”ç­”ï¼Œæ•°æ®1è¡¨ç¤ºéåº”ç­”
  61   1      
  62   1          SCL = 0;
  63   1          SDA = _data;
  64   1          SCL = 1;
  65   1          SCL = 0;
  66   1      }
  67          
  68          bit I2C_reserve_response(void)
  69          { //åœ¨å‘é€å®Œä¸€ä¸ªå­—èŠ‚ä¹‹åï¼Œä¸»æœºåœ¨ä¸‹ä¸€ä¸ªæ—¶é’Ÿæ¥æ”¶ä¸€ä½æ•°æ®ï¼Œåˆ¤æ–­ä»æœºæ˜¯å¦åº”ç­”
             -ï¼Œ
  70   1          //æ•°æ®0è¡¨ç¤ºåº”ç­”ï¼Œæ•°æ®1è¡¨ç¤ºéåº”ç­”ï¼ˆä¸»æœºåœ¨æ¥æ”¶ä¹‹å‰ï¼Œéœ€è¦é‡Šæ”¾SDAï¼‰
  71   1          bit _data;
  72   1          SDA = 1;
  73   1          SCL = 0;
  74   1          SCL = 1;
  75   1          _data = SDA;
  76   1          SCL = 0;
  77   1          return _data;
  78   1      }
  79          
  80          void AT24C02_write(char WordAddress, char _data)
  81          {
  82   1          I2C_start();
  83   1          I2C_send_byte(AT24C02_ADDR); //// AT24C02åœ°å€
  84   1          I2C_reserve_response();
  85   1          I2C_send_byte(WordAddress); //å†™åœ¨AT24C02å“ªé‡Œ
  86   1          I2C_reserve_response();
  87   1          I2C_send_byte(_data);
  88   1          I2C_reserve_response();
  89   1          I2C_stop();
  90   1      }
  91          char AT24C02_read(char WordAddress)
  92          {
  93   1          char _data;
  94   1          I2C_start();
  95   1          I2C_send_byte(AT24C02_ADDR);
  96   1          I2C_reserve_response();
  97   1          I2C_send_byte(WordAddress);
  98   1          I2C_reserve_response();
  99   1          I2C_start();
 100   1          I2C_send_byte(AT24C02_ADDR | 0x01); //ä»£è¡¨è¯»æŒ‡ä»¤
 101   1          I2C_reserve_response();
 102   1          _data = I2C_recerve_byte();
 103   1          I2C_send_response(0);
 104   1          I2C_stop();
 105   1          return _data;
 106   1      }
 107          // #include "LCD1602.h"
 108          // #include <INTRINS.H>
 109          // void Delayms(int num) //@11.0592MHz
 110          // {
 111          //     unsigned char i, j;
 112          //     while (num--)
C51 COMPILER V9.54   AT24C02                                                               11/09/2022 17:21:14 PAGE 3   

 113          //     {
 114          //         _nop_();
 115          //         _nop_();
 116          //         _nop_();
 117          //         i = 11;
 118          //         j = 190;
 119          //         do
 120          //         {
 121          //             while (--j)
 122          //                 ;
 123          //         } while (--i);
 124          //     }
 125          // }
 126          // void main()
 127          // {
 128          
 129          //     LCD_Init();
 130          //     Delayms(10);
 131          //     AT24C02_write(8, 0x0a);
 132          //     Delayms(10);
 133          
 134          //     Delayms(10);
 135          
 136          //     while (1)
 137          //     {
 138          //         Delayms(100);
 139          //         LCD_ShowSignedNum(1, 2, AT24C02_read(8), 2); //æ— æ³•æ˜¾ç¤ºè´Ÿæ•°
 140          //         P1 = AT24C02_read(0);
 141          //         Delayms(100);
 142          //     }
 143          // }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    195    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
